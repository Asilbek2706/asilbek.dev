name: Notify Telegram ğŸš€

on:
  workflow_run:
    workflows: ["Django Portfolio CI"] # CI workflow-ingiz nomi bilan bir xil bo'lishi kerak
    types: [completed]

jobs:
  on-success:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Success Message
        uses: appleboy/telegram-action@master
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          format: markdown
          message: |
            *âœ… TESTLAR MUVAFFAQIYATLI O'TDI*
            ------------------------------------
            *ğŸ“ Loyiha:* `${{ github.repository }}`
            *ğŸŒ¿ Branch:* `#${{ github.event.workflow_run.head_branch }}`
            *ğŸ‘¤ Muallif:* `${{ github.event.workflow_run.head_commit.author.name }}`
            
            *ğŸ“ Commit:*
            _${{ github.event.workflow_run.head_commit.message }}_
            
            *ğŸš€ Holat:* Barcha testlar va tekshiruvlar muvaffaqiyatli yakunlandi. Loyiha stabil!
            ------------------------------------
            *ğŸ¤– Asilbek.dev Monitoring System*

  on-failure:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    steps:
      - name: Failure Message
        uses: appleboy/telegram-action@master
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          format: markdown
          message: |
            *ğŸš¨ DIQQAT: XATOLIK ANIQLANDI!*
            ------------------------------------
            *ğŸ“ Loyiha:* `${{ github.repository }}`
            *ğŸŒ¿ Branch:* `#${{ github.event.workflow_run.head_branch }}`
            
            *âŒ Muammo:* Testlar yoki Build jarayonida xatolik yuz berdi. 
            
            *ğŸ”— Tekshirish:* [Xatolik loglarini ko'rish](${{ github.event.workflow_run.html_url }})
            ------------------------------------
            *âš ï¸ Iltimos, kodni qayta ko'rib chiqing!*
